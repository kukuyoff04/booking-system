<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡πÇ‡∏ï‡πä‡∏∞ & ‡∏ï‡∏£‡∏ß‡∏à‡∏ï‡∏±‡πã‡∏ß</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <style>
        body { background-color: #f0f2f5; font-family: 'Sarabun', sans-serif; }
        .main-container { max-width: 600px; margin: auto; }
        .card { border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border: none; }
        .nav-pills .nav-link { border-radius: 50px; padding: 10px 20px; font-weight: bold; }
        .nav-pills .nav-link.active { background-color: #0d6efd; box-shadow: 0 4px 10px rgba(13, 110, 253, 0.3); }
        #reader { width: 100%; border-radius: 10px; overflow: hidden; }
        .status-badge { font-size: 1.2rem; padding: 10px 20px; border-radius: 50px; }
    </style>
</head>
<body>

<div class="container py-4 main-container">
    <h3 class="text-center mb-4 fw-bold text-primary">üéüÔ∏è ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡πÇ‡∏ï‡πä‡∏∞‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∏‡∏ì</h3>

    <ul class="nav nav-pills nav-fill mb-4 bg-white p-2 rounded-pill shadow-sm" id="pills-tab" role="tablist">
        <li class="nav-item">
            <button class="nav-link active" id="pills-booking-tab" data-bs-toggle="pill" data-bs-target="#pills-booking" type="button">üìù ‡∏à‡∏≠‡∏á‡πÇ‡∏ï‡πä‡∏∞</button>
        </li>
        <li class="nav-item">
            <button class="nav-link" id="pills-scan-tab" data-bs-toggle="pill" data-bs-target="#pills-scan" type="button">üì∑ ‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô</button>
        </li>
    </ul>

    <div class="tab-content" id="pills-tabContent">
        
        <div class="tab-pane fade show active" id="pills-booking">
            <div class="card p-4">
                <h5 class="mb-3">‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h5>
                <form id="bookingForm">
                    <div class="mb-3">
                        <label class="form-label text-muted">‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</label>
                        <input type="text" class="form-control form-control-lg" id="name" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ä‡∏≤‡∏¢" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label text-muted">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                        <input type="tel" class="form-control form-control-lg" id="phone" placeholder="08x-xxx-xxxx" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label text-muted">‡πÄ‡∏•‡∏Ç‡πÇ‡∏ï‡πä‡∏∞ / ‡πÇ‡∏ã‡∏ô</label>
                        <input type="text" class="form-control form-control-lg" id="tableNo" placeholder="‡πÄ‡∏ä‡πà‡∏ô A1, Vip 2" required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-lg w-100 mt-2" id="btnSubmit">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏≠‡∏≠‡∏Å‡∏ï‡∏±‡πã‡∏ß</button>
                </form>
            </div>

            <div id="ticketResult" class="card p-4 text-center d-none mt-3">
                <div class="mb-3">
                    <span class="badge bg-success status-badge">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</span>
                </div>
                <h5 class="text-muted">‡∏£‡∏´‡∏±‡∏™‡∏à‡∏≠‡∏á: <span id="bookingId" class="text-dark fw-bold"></span></h5>
                <div class="d-flex justify-content-center my-3">
                    <img id="qrImage" src="" alt="QR Code" class="img-fluid border p-2 rounded bg-white shadow-sm" style="max-width: 250px;">
                </div>
                <div class="alert alert-info small">
                    ‡πÅ‡∏Ñ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ô‡∏µ‡πâ ‡∏´‡∏£‡∏∑‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û ‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏á‡∏≤‡∏ô
                </div>
                <button class="btn btn-outline-secondary w-100" onclick="location.reload()">üîÑ ‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà</button>
            </div>
        </div>

        <div class="tab-pane fade" id="pills-scan">
            <div class="card p-4">
                <h5 class="mb-3 text-center">‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h5>
                <div id="reader" class="bg-dark"></div>
                <div id="scanResult" class="mt-4 text-center">
                    <p class="text-muted">‡∏£‡∏≠‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // ------------------------------------------------------------------
    // ‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏´‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö (Update 12/12/2025)
    // ------------------------------------------------------------------
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzhIRxlPhsCKG_NO0uDLY4UqOMrPPwreBu_bR9QiQ4t7UgsRp8ozorfUJXNHGH01U-xKA/exec";

    // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á ---
    document.getElementById('bookingForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        // ‡∏•‡πá‡∏≠‡∏Ñ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏±‡∏ô‡∏Å‡∏î‡∏ã‡πâ‡∏≥
        const btn = document.getElementById('btnSubmit');
        const originalText = btn.innerText;
        btn.disabled = true;
        btn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';

        const formData = new FormData();
        formData.append('action', 'add');
        formData.append('Name', document.getElementById('name').value);
        formData.append('Phone', document.getElementById('phone').value);
        formData.append('Table', document.getElementById('tableNo').value);

        fetch(WEB_APP_URL, { method: 'POST', body: formData })
            .then(response => response.json())
            .then(data => {
                if(data.result === 'success') {
                    // ‡∏ã‡πà‡∏≠‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏° ‡πÅ‡∏™‡∏î‡∏á QR Code
                    document.getElementById('bookingForm').parentElement.classList.add('d-none');
                    document.getElementById('ticketResult').classList.remove('d-none');
                    document.getElementById('bookingId').innerText = data.id;
                    document.getElementById('qrImage').src = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${data.id}`;
                } else {
                    alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + JSON.stringify(data));
                    btn.disabled = false;
                    btn.innerText = originalText;
                }
            })
            .catch(err => {
                alert('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï: ' + err);
                btn.disabled = false;
                btn.innerText = originalText;
            });
    });

    // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏™‡πÅ‡∏Å‡∏ô QR Code ---
    let html5QrcodeScanner = null;

    function onScanSuccess(decodedText, decodedResult) {
        // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏à‡∏≠ ‡πÉ‡∏´‡πâ‡∏´‡∏¢‡∏∏‡∏î‡∏™‡πÅ‡∏Å‡∏ô‡∏Å‡πà‡∏≠‡∏ô
        if(html5QrcodeScanner) {
            html5QrcodeScanner.clear();
        }
        checkIn(decodedText);
    }

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡πÅ‡∏ó‡πá‡∏ö "‡∏™‡πÅ‡∏Å‡∏ô"
    document.getElementById('pills-scan-tab').addEventListener('shown.bs.tab', event => {
        if(!html5QrcodeScanner) {
            html5QrcodeScanner = new Html5QrcodeScanner("reader", { fps: 10, qrbox: 250 });
            html5QrcodeScanner.render(onScanSuccess);
        }
    });

    // ‡∏™‡πà‡∏á‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡πÄ‡∏ä‡πá‡∏Ñ‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô
    function checkIn(id) {
        const resultDiv = document.getElementById('scanResult');
        resultDiv.innerHTML = '<div class="spinner-border text-primary" role="status"></div><br>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...';

        const formData = new FormData();
        formData.append('action', 'checkin');
        formData.append('id', id);

        fetch(WEB_APP_URL, { method: 'POST', body: formData })
            .then(response => response.json())
            .then(data => {
                if(data.result === 'success') {
                    // ‡∏ú‡πà‡∏≤‡∏ô
                    resultDiv.innerHTML = `
                        <div class="alert alert-success shadow-sm">
                            <h1 class="display-4">‚úÖ ‡∏ú‡πà‡∏≤‡∏ô</h1>
                            <hr>
                            <h4 class="text-dark">${data.name}</h4>
                            <h2 class="text-primary fw-bold">‡πÇ‡∏ï‡πä‡∏∞: ${data.table}</h2>
                            <p class="mb-0 text-muted">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß</p>
                        </div>
                        <button class="btn btn-primary w-100 btn-lg shadow" onclick="location.reload()">üì∑ ‡∏™‡πÅ‡∏Å‡∏ô‡∏Ñ‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
                    `;
                } else {
                    // ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô (‡∏ã‡πâ‡∏≥ ‡∏´‡∏£‡∏∑‡∏≠ ‡πÑ‡∏°‡πà‡∏û‡∏ö)
                    resultDiv.innerHTML = `
                        <div class="alert alert-danger shadow-sm">
                            <h1 class="display-4">‚ùå ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô</h1>
                            <h3 class="fw-bold">${data.message}</h3>
                            <p>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏µ‡πâ‡∏≠‡∏≤‡∏à‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>
                        </div>
                        <button class="btn btn-secondary w-100 btn-lg" onclick="location.reload()">‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</button>
                    `;
                }
            })
            .catch(err => {
                resultDiv.innerHTML = `<div class="alert alert-warning">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${err}</div><button class="btn btn-secondary" onclick="location.reload()">‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</button>`;
            });
    }
</script>

</body>
</html>
